# @0xADADA’s bash prompt, inspired by gf3’s "Sexy" bash Prompt

if [[ $COLORTERM = gnome-* && $TERM = xterm ]] && infocmp gnome-256color >/dev/null 2>&1; then
    export TERM=gnome-256color
elif infocmp rxvt-unicode-256color >/dev/null 2>&1; then
    export TERM=rxvt-unicode-256color
elif infocmp xterm-256color >/dev/null 2>&1; then
    export TERM=xterm-256color
fi

if tput setaf 1 &> /dev/null; then
    tput sgr0
    if [[ $(tput colors) -ge 256 ]] 2>/dev/null; then
        BLACK=$(tput setaf 235)
        RED=$(tput setaf 124)
        RED_B=$(tput setab 124)
        GREEN=$(tput setaf 142)
        YELLOW=$(tput setaf 214)
        BLUE=$(tput setaf 66)
        PURPLE=$(tput setaf 175)
        AQUA=$(tput setaf 108)
        GRAY=$(tput setaf 246)
        WHITE=$(tput setaf 223)
        ORANGE=$(tput setaf 208)
    else
        BLACK=$(tput setaf 0)
        RED=$(tput setaf 1)
        RED_B=$(tput setab 9)
        GREEN=$(tput setaf 2)
        YELLOW=$(tput setaf 214)
        BLUE=$(tput setaf 4)
        PURPLE=$(tput setaf 13)
        AQUA=$(tput setaf 6)
        GRAY=$(tput setaf 7)
        WHITE=$(tput setaf 15)
        ORANGE=$(tput setaf 11)
    fi
    BOLD=$(tput bold)
    RESET=$(tput sgr0)
fi
export BLACK
export RED
export RED_B
export GREEN
export YELLOW
export BLUE
export PURPLE
export AQUA
export GRAY
export WHITE
export ORANGE
export BOLD
export RESET

function parse_git_dirty() {
    [[ $(git status 2> /dev/null | tail -n1) \
       != *"working directory clean"* ]] && echo $RED_B
}

function parse_git_branch() {
    git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' \
        -e "s/* \(.*\)/$(parse_git_dirty)\1/"
}

# Prompt prefix, use dollar for most, or beer for OS X
PREFIX="$ "
[[ $OSTYPE == darwin* ]] && PREFIX="🍺  "
export PS1="\[${AQUA}\]\u\[$WHITE\]@\[$BOLD\]\[$ORANGE\]\h\[$WHITE\]:\[$RESET\]\[$YELLOW\]\W \[$WHITE\]\$([[ -n \$(git branch 2> /dev/null) ]] && echo \"\")\[$PURPLE\]\[$(parse_git_branch)\]\[$RESET\]\[$WHITE\]$PREFIX\[$RESET\]"
# export PS1="\[$PURPLE\]\[$(parse_git_branch)\]\[$RESET\]\[$WHITE\]$PREFIX\[$RESET\]"
unset PREFIX
